datasource db {
  provider = "sqlite"
  url      = "file:./database.db"
}

generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

model Document {
  id        String   @id @default(uuid())
  content   String
  metadata  String?
  createdAt DateTime @default(now())
  chunks    Chunk[]
}

model Chunk {
  id         String   @id @default(uuid())
  documentId String
  content    String
  embedding  String
  position   Int
  createdAt  DateTime @default(now())
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
}

// LaMP Dataset Models
model LaMPTask {
  id          String       @id @default(uuid())
  taskNumber  Int          @unique  // 1, 2, 3, 4, 5, 6, 7
  name        String       // e.g., "Citation_Identification"
  description String?
  createdAt   DateTime     @default(now())
  samples     LaMPSample[]
}

model LaMPSample {
  id            String            @id @default(uuid())
  sampleId      String            // Original ID from dataset (e.g., "010")
  taskId        String
  input         String            // The task prompt/question
  output        String?           // Expected output (null for test set)
  split         String            // "train", "validation", "test"
  variant       String            // "user_based" or "time_based"
  createdAt     DateTime          @default(now())
  task          LaMPTask          @relation(fields: [taskId], references: [id], onDelete: Cascade)
  profileItems  ProfileDocument[]

  @@unique([sampleId, taskId, split, variant])
  @@index([taskId])
  @@index([split, variant])
}

model ProfileDocument {
  id         String     @id @default(uuid())
  profileId  String     // Original profile item ID from dataset
  sampleId   String
  title      String?
  content    String     // abstract or text field
  embedding  String     // Vector embedding for retrieval
  createdAt  DateTime   @default(now())
  sample     LaMPSample @relation(fields: [sampleId], references: [id], onDelete: Cascade)

  @@index([sampleId])
}
